<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EO: eoVariableLengthCrossover.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>eoVariableLengthCrossover.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// -*- mode: c++; c-indent-level: 4; c++-member-init-indent: 8; comment-column: 35; -*-</span>
00002 
00003 <span class="comment">//-----------------------------------------------------------------------------</span>
00004 <span class="comment">// eoVariableLengthCrossover.h</span>
00005 <span class="comment">// (c) GeNeura Team, 2000 - EEAAX 1999 - Maarten Keijzer 2000</span>
00006 <span class="comment">/*</span>
00007 <span class="comment">    This library is free software; you can redistribute it and/or</span>
00008 <span class="comment">    modify it under the terms of the GNU Lesser General Public</span>
00009 <span class="comment">    License as published by the Free Software Foundation; either</span>
00010 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
00011 <span class="comment"></span>
00012 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
00013 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00015 <span class="comment">    Lesser General Public License for more details.</span>
00016 <span class="comment"></span>
00017 <span class="comment">    You should have received a copy of the GNU Lesser General Public</span>
00018 <span class="comment">    License along with this library; if not, write to the Free Software</span>
00019 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Contact: Marc.Schoenauer@polytechnique.fr</span>
00022 <span class="comment">             mkeijzer@cs.vu.nl</span>
00023 <span class="comment"> */</span>
00024 <span class="comment">//-----------------------------------------------------------------------------</span>
00025 
00026 <span class="preprocessor">#ifndef _eoVariableLengthCrossover_h</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define _eoVariableLengthCrossover_h</span>
00028 <span class="preprocessor"></span>
00029 <span class="preprocessor">#include &lt;eoFunctor.h&gt;</span>
00030 <span class="preprocessor">#include &lt;eoOp.h&gt;</span>
00031 
00040 <span class="keyword">template</span> &lt;<span class="keyword">class</span> Atom&gt;
<a name="l00041"></a><a class="code" href="classeo_atom_exchange.html">00041</a> <span class="keyword">class </span><a class="code" href="classeo_atom_exchange.html">eoAtomExchange</a> : <span class="keyword">public</span> <a class="code" href="classeo_b_f.html">eoBF</a>&lt;unsigned, Atom &amp;, bool&gt;
00042 {
00043 <span class="keyword">public</span>:
<a name="l00045"></a><a class="code" href="classeo_atom_exchange.html#a0">00045</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classeo_atom_exchange.html#a0">randomize</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>){}
00047   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_atom_exchange.html#a1">className</a>() <span class="keyword">const</span>=0;
00048 };
00049 
00051 <span class="keyword">template</span> &lt;<span class="keyword">class</span> Atom&gt;
<a name="l00052"></a><a class="code" href="classeo_uniform_atom_exchange.html">00052</a> <span class="keyword">class </span><a class="code" href="classeo_uniform_atom_exchange.html">eoUniformAtomExchange</a>: <span class="keyword">public</span> <a class="code" href="classeo_atom_exchange.html">eoAtomExchange</a>&lt;Atom&gt;
00053 {
00054 <span class="keyword">public</span>:
00055     <a class="code" href="classeo_uniform_atom_exchange.html">eoUniformAtomExchange</a>(<span class="keywordtype">double</span> _rate=0.5):rate(_rate){}
00056 
<a name="l00061"></a><a class="code" href="classeo_uniform_atom_exchange.html#a1">00061</a>   <span class="keywordtype">void</span> <a class="code" href="classeo_uniform_atom_exchange.html#a1">randomize</a>(<span class="keywordtype">unsigned</span> _size1, <span class="keywordtype">unsigned</span> _size2)
00062   {
00063     mask.resize(_size1 + _size2);
00064     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;_size1+_size2; i++)
00065         mask[i]=eo::rng.flip(rate);
00066   }
00067 
<a name="l00069"></a><a class="code" href="classeo_uniform_atom_exchange.html#a2">00069</a>     <span class="keywordtype">bool</span> <a class="code" href="classeo_uniform_atom_exchange.html#a2">operator()</a>(<span class="keywordtype">unsigned</span> _i, Atom &amp; )
00070     {
00071       <span class="keywordflow">return</span> mask[_i];
00072     }
00073 
<a name="l00075"></a><a class="code" href="classeo_uniform_atom_exchange.html#a3">00075</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_uniform_atom_exchange.html#a3">className</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <span class="stringliteral">"eoUniformAtomExchange"</span>;}
00076 
00077 <span class="keyword">private</span>:
00078   <span class="keywordtype">double</span> rate;
00079   std::vector&lt;bool&gt; mask;
00080 };
00081 
00085 
00088 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
<a name="l00089"></a><a class="code" href="classeo_vl_atom_exchange_quad_op.html">00089</a> <span class="keyword">class </span><a class="code" href="classeo_vl_atom_exchange_quad_op.html">eoVlAtomExchangeQuadOp</a> : <span class="keyword">public</span> <a class="code" href="classeo_quad_op.html">eoQuadOp</a>&lt;EOT&gt;
00090 {
00091 <span class="keyword">public</span> :
00092 
00093   <span class="keyword">typedef</span> <span class="keyword">typename</span> EOT::AtomType AtomType;
00094 
<a name="l00096"></a><a class="code" href="classeo_vl_atom_exchange_quad_op.html#a0">00096</a>   <a class="code" href="classeo_vl_atom_exchange_quad_op.html#a0">eoVlAtomExchangeQuadOp</a>(<span class="keywordtype">unsigned</span> _Min, <span class="keywordtype">unsigned</span> _Max,
00097                          <a class="code" href="classeo_atom_exchange.html">eoAtomExchange&lt;AtomType&gt;</a>&amp; _atomExchange):
00098     Min(_Min), Max(_Max), atomExchange(_atomExchange) {}
00099 
<a name="l00100"></a><a class="code" href="classeo_vl_atom_exchange_quad_op.html#a1">00100</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_vl_atom_exchange_quad_op.html#a1">operator()</a>(<a class="code" href="struct_dummy.html">EOT</a> &amp; _eo1, <a class="code" href="struct_dummy.html">EOT</a> &amp; _eo2)
00101   {
00102     <a class="code" href="struct_dummy.html">EOT</a> tmp1, tmp2;                <span class="comment">// empty individuals</span>
00103     <span class="keywordtype">unsigned</span> index=0;
00104     <span class="comment">// main loop: until sizes are OK, do only simulated exchange</span>
00105     <span class="keywordtype">unsigned</span> i, i1, i2;
00106     <span class="keywordflow">do</span> {
00107       <span class="comment">// "initialize the AtomExchange</span>
00108       atomExchange.<a class="code" href="classeo_atom_exchange.html#a0">randomize</a>(_eo1.size(), _eo2.size());
00109       <span class="comment">// simulate crossover</span>
00110       i1=i2=0;
00111       <span class="keywordflow">for</span> (i=0; i&lt;_eo1.size(); i++)
00112         {
00113           <span class="keywordflow">if</span> (atomExchange(i, _eo1[i]))
00114             i1++;
00115           <span class="keywordflow">else</span>
00116             i2++;
00117         }
00118       <span class="keywordflow">for</span> (i=0; i&lt;_eo2.size(); i++)
00119         {
00120           <span class="keywordflow">if</span> (atomExchange(i, _eo2[i]))
00121             i2++;
00122           <span class="keywordflow">else</span>
00123             i1++;
00124         }
00125       index++;
00126     } <span class="keywordflow">while</span> ( ( (i1&lt;Min) || (i2&lt;Min) ||
00127                 (i1&gt;Max) || (i2&gt;Max) )
00128               &amp;&amp; (index&lt;10000) );
00129     <span class="keywordflow">if</span> (index &gt;= 10000)
00130       {
00131         std::cout &lt;&lt; <span class="stringliteral">"Warning: impossible to generate individual of the right size in 10000 trials\n"</span>;
00132         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00133       }
00134   <span class="comment">// here we know we have the right sizes: do the actual exchange</span>
00135       <span class="keywordflow">for</span> (i=0; i&lt;_eo1.size(); i++)
00136         {
00137           <span class="keywordflow">if</span> (atomExchange(i, _eo1[i]))
00138             tmp1.push_back(_eo1[i]);
00139           <span class="keywordflow">else</span>
00140             tmp2.push_back(_eo1[i]);
00141         }
00142       <span class="keywordflow">for</span> (i=0; i&lt;_eo2.size(); i++)
00143         {
00144           <span class="keywordflow">if</span> (atomExchange(i, _eo2[i]))
00145             tmp2.push_back(_eo2[i]);
00146           <span class="keywordflow">else</span>
00147             tmp1.push_back(_eo2[i]);
00148         }
00149       <span class="comment">// and put everything back in place</span>
00150     _eo1.swap(tmp1);
00151     _eo2.swap(tmp2);
00152     <span class="keywordflow">return</span> <span class="keyword">true</span>;         <span class="comment">// should we test that? Yes, but no time now</span>
00153   }
00154 
<a name="l00156"></a><a class="code" href="classeo_vl_atom_exchange_quad_op.html#a2">00156</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_vl_atom_exchange_quad_op.html#a2">className</a>()<span class="keyword"> const</span>
00157 <span class="keyword">  </span>{
00158       std::ostringstream os;
00159       os &lt;&lt; <span class="stringliteral">"eoVlAtomExchangeQuadOp("</span> &lt;&lt; atomExchange.<a class="code" href="classeo_atom_exchange.html#a1">className</a>() &lt;&lt; <span class="stringliteral">")"</span>;
00160       <span class="keywordflow">return</span> os.str();
00161   }
00162 
00163 <span class="keyword">private</span>:
00164   <span class="keywordtype">unsigned</span> Min, Max;
00165   <a class="code" href="classeo_atom_exchange.html">eoAtomExchange&lt;AtomType&gt;</a> &amp; atomExchange;
00166 };
00167 
00171 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
<a name="l00172"></a><a class="code" href="classeo_inner_exchange_quad_op.html">00172</a> <span class="keyword">class </span><a class="code" href="classeo_inner_exchange_quad_op.html">eoInnerExchangeQuadOp</a> : <span class="keyword">public</span> <a class="code" href="classeo_quad_op.html">eoQuadOp</a>&lt;EOT&gt;
00173 {
00174 <span class="keyword">public</span> :
00175 
00176   <span class="keyword">typedef</span> <span class="keyword">typename</span> EOT::AtomType AtomType;
00177 
<a name="l00179"></a><a class="code" href="classeo_inner_exchange_quad_op.html#a0">00179</a>   <a class="code" href="classeo_inner_exchange_quad_op.html#a0">eoInnerExchangeQuadOp</a>( <a class="code" href="classeo_quad_op.html">eoQuadOp&lt;AtomType&gt;</a>&amp; _op, <span class="keywordtype">float</span> _rate = 0.5):
00180     op(_op), rate( _rate ) {}
00181 
<a name="l00183"></a><a class="code" href="classeo_inner_exchange_quad_op.html#a1">00183</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_inner_exchange_quad_op.html#a1">operator()</a>(<a class="code" href="struct_dummy.html">EOT</a> &amp; _eo1, <a class="code" href="struct_dummy.html">EOT</a> &amp; _eo2)
00184   {
00185     <span class="keywordtype">unsigned</span> size1 = _eo1.size(), size2 = _eo2.size(), minsize = ( size1 &gt; size2)?size2:size1;
00186     <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;
00187     <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> i = 0; i &lt; minsize; i ++ ) {
00188       <span class="keywordflow">if</span> ( rng.<a class="code" href="classeo_rng.html#a6">flip</a>( rate ) ) {
00189         <span class="keywordtype">bool</span> changedHere = op( _eo1[i], _eo2[i] );
00190         changed |= changedHere;
00191       }
00192     }
00193     <span class="keywordflow">return</span> changed;      <span class="comment">// should we test that? Yes, but no time now</span>
00194   }
00195 
00196   <span class="keyword">virtual</span> std::string className()<span class="keyword"> const</span>
00197 <span class="keyword">  </span>{
00198     <span class="keywordflow">return</span> <span class="stringliteral">"eoInnerExchangeQuadOp("</span> + op.<a class="code" href="classeo_quad_op.html#a1">className</a>() + <span class="stringliteral">")"</span>;
00199   }
00200 
00201 <span class="keyword">private</span>:
00202   <span class="keywordtype">float</span> rate;
00203   <a class="code" href="classeo_quad_op.html">eoQuadOp&lt;AtomType&gt;</a> &amp; op;
00204 };
00205 
00206 
00207 
00208 
00218 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
<a name="l00219"></a><a class="code" href="classeo_vl_uniform_quad_op.html">00219</a> <span class="keyword">class </span><a class="code" href="classeo_vl_uniform_quad_op.html">eoVlUniformQuadOp</a> : <span class="keyword">public</span> <a class="code" href="classeo_quad_op.html">eoQuadOp</a>&lt;EOT&gt;
00220 {
00221 <span class="keyword">public</span> :
00222 
00223   <span class="keyword">typedef</span> <span class="keyword">typename</span> EOT::AtomType AtomType;
00224 
00225   <span class="comment">// default ctor: requires bounds on number of genes + a rate</span>
00226   <a class="code" href="classeo_vl_uniform_quad_op.html">eoVlUniformQuadOp</a>(<span class="keywordtype">unsigned</span> _Min, <span class="keywordtype">unsigned</span> _Max, <span class="keywordtype">double</span> _rate=0.5) :
00227     Min(_Min), Max(_Max), rate(_rate) {}
00228 
<a name="l00229"></a><a class="code" href="classeo_vl_uniform_quad_op.html#a1">00229</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_vl_uniform_quad_op.html#a1">operator()</a>(<a class="code" href="struct_dummy.html">EOT</a> &amp; _eo1, <a class="code" href="struct_dummy.html">EOT</a> &amp; _eo2)
00230   {
00231     <span class="keywordtype">unsigned</span> i;
00232     <a class="code" href="struct_dummy.html">EOT</a> tmp1, tmp2;
00233     <span class="keywordtype">unsigned</span> index=0;
00234     <span class="keywordflow">do</span> {
00235       <span class="keywordflow">for</span> (i=0; i&lt;_eo1.size(); i++)
00236         {
00237           <span class="keywordflow">if</span> (eo::rng.flip(rate))
00238             tmp1.push_back(_eo1[i]);
00239           <span class="keywordflow">else</span>
00240             tmp2.push_back(_eo1[i]);
00241           <span class="comment">// here we should look for _eo1[i] inside _eo2 and erase it if found!</span>
00242         }
00243       <span class="keywordflow">for</span> (i=0; i&lt;_eo2.size(); i++)
00244         {
00245           <span class="keywordflow">if</span> (eo::rng.flip(rate))
00246             tmp1.push_back(_eo2[i]);
00247           <span class="keywordflow">else</span>
00248             tmp2.push_back(_eo2[i]);
00249         }
00250       index++;
00251     } <span class="keywordflow">while</span> ( ( (tmp1.size()&lt;Min) || (tmp2.size()&lt;Min) ||
00252               (tmp1.size()&gt;Max) || (tmp2.size()&gt;Max) )
00253               &amp;&amp; (index&lt;10000) );
00254     <span class="keywordflow">if</span> (index &gt;= 10000)
00255       {
00256         std::cout &lt;&lt; <span class="stringliteral">"Warning: impossible to generate individual of the right size in 10000 trials\n"</span>;
00257         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00258       }
00259 
00260     _eo1.swap(tmp1);
00261     _eo2.swap(tmp2);
00262     <span class="keywordflow">return</span> <span class="keyword">true</span>;                   <span class="comment">// should we test that?</span>
00263   }
00264 <span class="keyword">private</span>:
00265   <span class="keywordtype">unsigned</span> Min, Max;
00266   <span class="keywordtype">double</span> rate;
00267 };
00268 
00269 
00279 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
<a name="l00280"></a><a class="code" href="classeo_vl_uniform_bin_op.html">00280</a> <span class="keyword">class </span><a class="code" href="classeo_vl_uniform_bin_op.html">eoVlUniformBinOp</a> : <span class="keyword">public</span> <a class="code" href="classeo_bin_op.html">eoBinOp</a>&lt;EOT&gt;
00281 {
00282 <span class="keyword">public</span> :
00283 
00284   <span class="keyword">typedef</span> <span class="keyword">typename</span> EOT::AtomType AtomType;
00285 
00286   <span class="comment">// default ctor: requires bounds on number of genes + a rate</span>
00287   <a class="code" href="classeo_vl_uniform_bin_op.html">eoVlUniformBinOp</a>(<span class="keywordtype">unsigned</span> _Min, <span class="keywordtype">unsigned</span> _Max, <span class="keywordtype">double</span> _rate=0.5) :
00288     Min(_Min), Max(_Max), rate(_rate) {}
00289 
<a name="l00290"></a><a class="code" href="classeo_vl_uniform_bin_op.html#a1">00290</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_vl_uniform_bin_op.html#a1">operator()</a>(<a class="code" href="struct_dummy.html">EOT</a> &amp; _eo1, <span class="keyword">const</span> <a class="code" href="struct_dummy.html">EOT</a> &amp; _eo2)
00291   {
00292     <span class="keywordtype">unsigned</span> i;
00293     <a class="code" href="struct_dummy.html">EOT</a> tmp1;
00294     <span class="keywordtype">bool</span> tmpIsOne=<span class="keyword">true</span>, tmpIsTwo=<span class="keyword">true</span>;
00295     <span class="keywordtype">unsigned</span> index=0;
00296     <span class="keywordflow">do</span> {
00297       <span class="keywordflow">for</span> (i=0; i&lt;_eo1.size(); i++)
00298         {
00299           <span class="keywordflow">if</span> (eo::rng.flip(rate))
00300             {
00301               tmp1.push_back(_eo1[i]);
00302               tmpIsTwo = <span class="keyword">false</span>;
00303             }
00304           <span class="keywordflow">else</span>
00305             tmpIsOne=<span class="keyword">false</span>;
00306         <span class="comment">// we should look for _eo1[i] inside _eo2 and erase it there if found!</span>
00307         }
00308       <span class="keywordflow">for</span> (i=0; i&lt;_eo2.size(); i++)
00309         {
00310           <span class="keywordflow">if</span> (! eo::rng.flip(rate))
00311             {
00312               tmp1.push_back(_eo2[i]);
00313               tmpIsOne = <span class="keyword">false</span>;
00314             }
00315           <span class="keywordflow">else</span>
00316             tmpIsTwo = <span class="keyword">false</span>;
00317         }
00318       index++;
00319     } <span class="keywordflow">while</span> ( ( (tmp1.size()&lt;Min) || (tmp1.size()&gt;Max) )
00320               &amp;&amp; (index&lt;10000) );
00321     <span class="comment">// this while condition is not optimal, as it may take some time</span>
00322     <span class="keywordflow">if</span> (index &gt;= 10000)
00323       {
00324         std::cout &lt;&lt; <span class="stringliteral">"Warning: impossible to generate individual of the right size in 10000 trials\n"</span>;
00325         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00326       }
00327 
00328     _eo1.swap(tmp1);
00329     <span class="keywordflow">if</span> (tmpIsTwo)
00330       {
00331         <span class="comment">//      _eo1.fitness(_eo2.fitness());     NO FITNESS EXISTS HERE!</span>
00332         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00333       }
00334     <span class="keywordflow">if</span> (tmpIsOne)                  <span class="comment">// already has the right fitness</span>
00335       {                            <span class="comment">// WRONG: NO FITNESS EXISTS HERE!</span>
00336         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00337       }
00338     <span class="keywordflow">return</span> <span class="keyword">true</span>;                   <span class="comment">// there were some modifications...</span>
00339   }
00340 
00341 <span class="keyword">private</span>:
00342   <span class="keywordtype">unsigned</span> Min, Max;
00343   <span class="keywordtype">double</span> rate;
00344 };
00345 
00346 
00347 
00348 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 05:06:39 2006 for EO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
