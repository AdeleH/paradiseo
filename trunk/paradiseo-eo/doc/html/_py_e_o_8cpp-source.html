<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EO: PyEO.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">pyeo</a></div>
<h1>PyEO.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">    PyEO</span>
00003 <span class="comment"></span>
00004 <span class="comment">    Copyright (C) 2003 Maarten Keijzer</span>
00005 <span class="comment"></span>
00006 <span class="comment">    This program is free software; you can redistribute it and/or modify</span>
00007 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
00008 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
00009 <span class="comment">    (at your option) any later version.</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This program is distributed in the hope that it will be useful,</span>
00012 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00014 <span class="comment">    GNU General Public License for more details.</span>
00015 <span class="comment"></span>
00016 <span class="comment">    You should have received a copy of the GNU General Public License</span>
00017 <span class="comment">    along with this program; if not, write to the Free Software</span>
00018 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00019 <span class="comment">*/</span>
00020 
00021 <span class="preprocessor">#include &lt;sstream&gt;</span>
00022 
00023 <span class="preprocessor">#include "PyEO.h"</span>
00024 <span class="preprocessor">#include &lt;eoPop.h&gt;</span>
00025 
00026 
00027 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00028 <span class="comment">//using namespace boost::python;</span>
00029 
00030 <span class="comment">// static member, needs to be instantiated somewhere</span>
00031 std::vector&lt;int&gt; PyFitness::objective_info;
00032 
00033 <span class="keywordtype">bool</span> PyFitness::dominates(<span class="keyword">const</span> PyFitness&amp; oth)<span class="keyword"> const</span>
00034 <span class="keyword"></span>{
00035     <span class="keywordtype">bool</span> dom = <span class="keyword">false</span>;
00036 
00037     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; nObjectives(); ++i)
00038     {
00039       <span class="keywordtype">int</span> objective = objective_info[i];
00040 
00041       <span class="keywordflow">if</span> (objective == 0) <span class="comment">// ignore</span>
00042           <span class="keywordflow">continue</span>;
00043 
00044       <span class="keywordtype">bool</span> maxim = objective &gt; 0;
00045 
00046       <span class="keywordtype">double</span> aval = maxim? (*this)[i] : -(*this)[i];
00047       <span class="keywordtype">double</span> bval = maxim? oth[i] : -oth[i];
00048 
00049       <span class="keywordflow">if</span> (fabs(aval - bval) &gt; tol())
00050       {
00051         <span class="keywordflow">if</span> (aval &lt; bval)
00052         {
00053           <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// cannot dominate</span>
00054         }
00055         <span class="comment">// else aval &lt; bval</span>
00056         dom = <span class="keyword">true</span>; <span class="comment">// for the moment: goto next objective</span>
00057       }
00058       <span class="comment">//else they're equal in this objective, goto next</span>
00059     }
00060 
00061     <span class="keywordflow">return</span> dom;
00062 }
00063 
00064 <span class="keywordtype">bool</span> dominates(<span class="keyword">const</span> PyEO&amp; a, <span class="keyword">const</span> PyEO&amp; b)
00065 {
00066     <span class="keywordflow">return</span> PyFitness(a.fitness()).dominates(b.fitness());
00067 }
00068 
00069 ostream&amp; operator&lt;&lt;(ostream&amp; os, <span class="keyword">const</span> PyEO&amp; _eo)
00070 {
00071     os &lt;&lt; _eo.to_string();
00072     <span class="keywordflow">return</span> os;
00073 }
00074 
00075 <span class="keyword">struct </span>pyPop_pickle_suite : boost::python::pickle_suite
00076 {
00077     <span class="keyword">static</span> boost::python::tuple getstate(<span class="keyword">const</span> <a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; _pop)
00078     {
00079         boost::python::list entries;
00080         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i != _pop.size(); ++i)
00081             entries.append( PyEO_pickle_suite::getstate(_pop[i]) );
00082 
00083         <span class="keywordflow">return</span> boost::python::make_tuple(boost::python::object(_pop.size()), entries);
00084     }
00085 
00086     <span class="keyword">static</span> <span class="keywordtype">void</span> setstate( <a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; _pop, boost::python::tuple pickled)
00087     {
00088         <span class="keywordtype">int</span> sz = boost::python::extract&lt;int&gt;(pickled[0]);
00089         boost::python::list entries = boost::python::list(pickled[1]);
00090         _pop.resize(sz);
00091         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i != _pop.size(); ++i)
00092         {
00093             PyEO_pickle_suite::setstate(_pop[i], boost::python::tuple(entries[i]) );
00094         }
00095     }
00096 };
00097 
00098 
00099 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
00100 boost::python::str to_string(T&amp; _p)
00101 {
00102     std::ostringstream os;
00103     _p.<a class="code" href="classeo_pop.html#a18">printOn</a>(os);
00104     <span class="keywordflow">return</span> boost::python::str(os.str().c_str());
00105 }
00106 
00107 <span class="keywordtype">void</span> pop_sort(<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; pop) { pop.<a class="code" href="classeo_pop.html#a5">sort</a>(); }
00108 <span class="keywordtype">void</span> pop_shuffle(<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; pop) { pop.<a class="code" href="classeo_pop.html#a7">shuffle</a>(); }
00109 
00110 <span class="keywordtype">void</span> translate_index_error(index_error <span class="keyword">const</span>&amp; e)
00111 {
00112         PyErr_SetString(PyExc_IndexError, e.what.c_str());
00113 }
00114 
00115 PyEO&amp; pop_getitem(<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; pop, boost::python::object key)
00116 {
00117     boost::python::extract&lt;int&gt; x(key);
00118     <span class="keywordflow">if</span> (!x.check())
00119         <span class="keywordflow">throw</span> index_error(<span class="stringliteral">"Slicing not allowed"</span>);
00120 
00121     <span class="keywordtype">int</span> i = x();
00122 
00123     <span class="keywordflow">if</span> (static_cast&lt;unsigned&gt;(i) &gt;= pop.size())
00124     {
00125         <span class="keywordflow">throw</span> index_error(<span class="stringliteral">"Index out of bounds"</span>);
00126     }
00127     <span class="keywordflow">return</span> pop[i];
00128 }
00129 
00130 <span class="keywordtype">void</span> pop_setitem(<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; pop, boost::python::object key, PyEO&amp; value)
00131 {
00132     boost::python::extract&lt;int&gt; x(key);
00133     <span class="keywordflow">if</span> (!x.check())
00134         <span class="keywordflow">throw</span> index_error(<span class="stringliteral">"Slicing not allowed"</span>);
00135 
00136     <span class="keywordtype">int</span> i = x();
00137 
00138     <span class="keywordflow">if</span> (static_cast&lt;unsigned&gt;(i) &gt;= pop.size())
00139     {
00140         <span class="keywordflow">throw</span> index_error(<span class="stringliteral">"Index out of bounds"</span>);
00141     }
00142 
00143     pop[i] = value;
00144 }
00145 
00146 <span class="keywordtype">void</span> pop_push_back(<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; pop, PyEO&amp; p) { pop.push_back(p); }
00147 <span class="keywordtype">void</span> pop_resize(   <a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>&amp; pop, <span class="keywordtype">unsigned</span> i) { pop.resize(i); }
00148 
00149 <span class="keyword">extern</span> <span class="keywordtype">void</span> abstract1();
00150 <span class="keyword">extern</span> <span class="keywordtype">void</span> algos();
00151 <span class="keyword">extern</span> <span class="keywordtype">void</span> random_numbers();
00152 <span class="keyword">extern</span> <span class="keywordtype">void</span> geneticOps();
00153 <span class="keyword">extern</span> <span class="keywordtype">void</span> selectOne();
00154 <span class="keyword">extern</span> <span class="keywordtype">void</span> continuators();
00155 <span class="keyword">extern</span> <span class="keywordtype">void</span> reduce();
00156 <span class="keyword">extern</span> <span class="keywordtype">void</span> replacement();
00157 <span class="keyword">extern</span> <span class="keywordtype">void</span> selectors();
00158 <span class="keyword">extern</span> <span class="keywordtype">void</span> breeders();
00159 <span class="keyword">extern</span> <span class="keywordtype">void</span> mergers();
00160 <span class="keyword">extern</span> <span class="keywordtype">void</span> valueParam();
00161 <span class="keyword">extern</span> <span class="keywordtype">void</span> perf2worth();
00162 <span class="keyword">extern</span> <span class="keywordtype">void</span> monitors();
00163 <span class="keyword">extern</span> <span class="keywordtype">void</span> statistics();
00164 
00165 BOOST_PYTHON_MODULE(PyEO)
00166 {
00167     <span class="keyword">using</span> <span class="keyword">namespace </span>boost::python;
00168 
00169     boost::python::register_exception_translator&lt;index_error&gt;(&amp;translate_index_error);
00170 
00171     boost::python::class_&lt;PyEO&gt;(<span class="stringliteral">"EO"</span>)
00172         .add_property(<span class="stringliteral">"fitness"</span>, &amp;PyEO::getFitness, &amp;PyEO::setFitness)
00173         .add_property(<span class="stringliteral">"genome"</span>, &amp;PyEO::getGenome, &amp;PyEO::setGenome)
00174         .def_pickle(PyEO_pickle_suite())
00175         .def(<span class="stringliteral">"invalidate"</span>, &amp;PyEO::invalidate)
00176         .def(<span class="stringliteral">"invalid"</span>, &amp;PyEO::invalid)
00177         .def(<span class="stringliteral">"__str__"</span>, &amp;PyEO::to_string)
00178         ;
00179 
00180     boost::python::class_&lt;eoPop&lt;PyEO&gt; &gt;(<span class="stringliteral">"eoPop"</span>, init&lt;&gt;() )
00181         .def( init&lt; <span class="keywordtype">unsigned</span>, <a class="code" href="classeo_init.html">eoInit&lt;PyEO&gt;</a>&amp; &gt;()[with_custodian_and_ward&lt;1,3&gt;()] )
00182         .def(<span class="stringliteral">"append"</span>, &amp;<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>::append)
00183         .def(<span class="stringliteral">"__str__"</span>, to_string&lt;<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a> &gt;)
00184         .def(<span class="stringliteral">"__len__"</span>, &amp;<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>::size)
00185         .def(<span class="stringliteral">"sort"</span>,    pop_sort )
00186         .def(<span class="stringliteral">"shuffle"</span>, pop_shuffle)
00187         .def(<span class="stringliteral">"__getitem__"</span>, pop_getitem, return_internal_reference&lt;&gt;() )
00188         .def(<span class="stringliteral">"__setitem__"</span>, pop_setitem)
00189         .def(<span class="stringliteral">"best"</span>, &amp;<a class="code" href="classeo_pop.html">eoPop&lt;PyEO&gt;</a>::best_element, return_internal_reference&lt;&gt;() )
00190         .def(<span class="stringliteral">"push_back"</span>, pop_push_back)
00191         .def(<span class="stringliteral">"resize"</span>,    pop_resize)
00192         .def_pickle(pyPop_pickle_suite())
00193         ;
00194 
00195 
00196     <span class="comment">// Other definitions in different compilation units,</span>
00197     <span class="comment">// this to avoid having g++ to choke on the load</span>
00198     random_numbers();
00199     valueParam();
00200     abstract1();
00201     geneticOps();
00202     selectOne();
00203     selectors();
00204     perf2worth();
00205     monitors();
00206     statistics();
00207     continuators();
00208     reduce();
00209     replacement();
00210     breeders();
00211     mergers();
00212     algos();
00213 
00214     <span class="comment">// The traits class</span>
00215     class_&lt;PyFitness&gt;(<span class="stringliteral">"PyFitness"</span>);
00216 
00217         def(<span class="stringliteral">"nObjectives"</span>, &amp;PyFitness::nObjectives);
00218         def(<span class="stringliteral">"tol"</span>, &amp;PyFitness::tol);
00219         def(<span class="stringliteral">"maximizing"</span>, &amp;PyFitness::maximizing);
00220         def(<span class="stringliteral">"setObjectivesSize"</span>, &amp;PyFitness::setObjectivesSize);
00221         def(<span class="stringliteral">"setObjectivesValue"</span>, &amp;PyFitness::setObjectivesValue);
00222         def(<span class="stringliteral">"dominates"</span>, dominates);
00223 }
00224 
00225 
00226 <span class="comment">// to avoid having to build with libeo.a</span>
00227 ostream &amp; operator &lt;&lt; ( ostream&amp; _os, <span class="keyword">const</span> <a class="code" href="classeo_printable.html">eoPrintable</a>&amp; _o ) {
00228             _o.<a class="code" href="classeo_printable.html#a1">printOn</a>(_os);
00229                     <span class="keywordflow">return</span> _os;
00230 };
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 05:06:41 2006 for EO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
