<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EO: eoNormalMutation.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000010.html">es</a></div>
<h1>eoNormalMutation.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// -*- mode: c++; c-indent-level: 4; c++-member-init-indent: 8; comment-column: 35; -*-</span>
00002 
00003 <span class="comment">//-----------------------------------------------------------------------------</span>
00004 <span class="comment">// eoNormalMutation.h</span>
00005 <span class="comment">// (c) EEAAX 2001 - Maarten Keijzer 2000</span>
00006 <span class="comment">/*</span>
00007 <span class="comment">    This library is free software; you can redistribute it and/or</span>
00008 <span class="comment">    modify it under the terms of the GNU Lesser General Public</span>
00009 <span class="comment">    License as published by the Free Software Foundation; either</span>
00010 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
00011 <span class="comment"></span>
00012 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
00013 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00015 <span class="comment">    Lesser General Public License for more details.</span>
00016 <span class="comment"></span>
00017 <span class="comment">    You should have received a copy of the GNU Lesser General Public</span>
00018 <span class="comment">    License along with this library; if not, write to the Free Software</span>
00019 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Contact: Marc.Schoenauer@polytechnique.fr</span>
00022 <span class="comment">             mak@dhi.dk</span>
00023 <span class="comment"> */</span>
00024 <span class="comment">//-----------------------------------------------------------------------------</span>
00025 
00026 <span class="preprocessor">#ifndef eoNormalMutation_h</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define eoNormalMutation_h</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">//-----------------------------------------------------------------------------</span>
00030 
00031 <span class="preprocessor">#include &lt;algorithm&gt;</span>    <span class="comment">// swap_ranges</span>
00032 <span class="preprocessor">#include &lt;utils/eoRNG.h&gt;</span>
00033 <span class="preprocessor">#include &lt;utils/eoUpdatable.h&gt;</span>
00034 <span class="preprocessor">#include &lt;eoEvalFunc.h&gt;</span>
00035 <span class="preprocessor">#include &lt;es/eoReal.h&gt;</span>
00036 <span class="preprocessor">#include &lt;utils/eoRealBounds.h&gt;</span>
00037 <span class="comment">//-----------------------------------------------------------------------------</span>
00038 
<a name="l00048"></a><a class="code" href="classeo_normal_vec_mutation.html">00048</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> EOT&gt; <span class="keyword">class </span><a class="code" href="classeo_normal_vec_mutation.html">eoNormalVecMutation</a>: <span class="keyword">public</span> <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt;EOT&gt;
00049 {
00050  <span class="keyword">public</span>:
<a name="l00058"></a><a class="code" href="classeo_normal_vec_mutation.html#a0">00058</a>   <a class="code" href="classeo_normal_vec_mutation.html#a0">eoNormalVecMutation</a>(<span class="keywordtype">double</span> _sigma, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; _p_change = 1.0):
00059     sigma(_sigma), bounds(eoDummyVectorNoBounds), p_change(_p_change) {}
00060 
<a name="l00069"></a><a class="code" href="classeo_normal_vec_mutation.html#a1">00069</a>   <a class="code" href="classeo_normal_vec_mutation.html#a0">eoNormalVecMutation</a>(<a class="code" href="classeo_real_vector_bounds.html">eoRealVectorBounds</a> &amp; _bounds,
00070                     <span class="keywordtype">double</span> _sigma, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; _p_change = 1.0):
00071     sigma(_bounds.size(), _sigma), bounds(_bounds), p_change(_p_change)
00072   {
00073     <span class="comment">// scale to the range - if any</span>
00074     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;bounds.size(); i++)
00075       <span class="keywordflow">if</span> (bounds.<a class="code" href="classeo_real_base_vector_bounds.html#a4">isBounded</a>(i))
00076           sigma[i] *= _sigma*bounds.<a class="code" href="classeo_real_base_vector_bounds.html#a18">range</a>(i);
00077   }
00078 
<a name="l00080"></a><a class="code" href="classeo_normal_vec_mutation.html#a2">00080</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_normal_vec_mutation.html#a2">className</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">"eoNormalVecMutation"</span>; }
00081 
<a name="l00086"></a><a class="code" href="classeo_normal_vec_mutation.html#a3">00086</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_normal_vec_mutation.html#a3">operator()</a>(<a class="code" href="struct_dummy.html">EOT</a>&amp; _eo)
00087     {
00088       <span class="keywordtype">bool</span> hasChanged=<span class="keyword">false</span>;
00089       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> lieu=0; lieu&lt;_eo.size(); lieu++)
00090         {
00091           <span class="keywordflow">if</span> (rng.<a class="code" href="classeo_rng.html#a6">flip</a>(p_change))
00092             {
00093               _eo[lieu] += sigma[lieu]*rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00094               bounds.<a class="code" href="classeo_real_base_vector_bounds.html#a10">foldsInBounds</a>(lieu, _eo[lieu]);
00095               hasChanged = <span class="keyword">true</span>;
00096             }
00097         }
00098       <span class="keywordflow">return</span> hasChanged;
00099     }
00100 
00101 <span class="keyword">private</span>:
00102   std::vector&lt;double&gt; sigma;
00103   <a class="code" href="classeo_real_vector_bounds.html">eoRealVectorBounds</a> &amp; bounds;
00104   <span class="keywordtype">double</span> p_change;
00105 };
00106 
<a name="l00116"></a><a class="code" href="classeo_normal_mutation.html">00116</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> EOT&gt; <span class="keyword">class </span><a class="code" href="classeo_normal_mutation.html">eoNormalMutation</a>
00117     : <span class="keyword">public</span> <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt;EOT&gt;
00118 {
00119 <span class="keyword">public</span>:
<a name="l00127"></a><a class="code" href="classeo_normal_mutation.html#a0">00127</a>   <a class="code" href="classeo_normal_mutation.html#a0">eoNormalMutation</a>(<span class="keywordtype">double</span> &amp; _sigma, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; _p_change = 1.0):
00128     sigma(_sigma), bounds(eoDummyVectorNoBounds), p_change(_p_change) {}
00129 
<a name="l00136"></a><a class="code" href="classeo_normal_mutation.html#a1">00136</a>   <a class="code" href="classeo_normal_mutation.html#a0">eoNormalMutation</a>(<a class="code" href="classeo_real_vector_bounds.html">eoRealVectorBounds</a> &amp; _bounds,
00137                     <span class="keywordtype">double</span> _sigma, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; _p_change = 1.0):
00138     sigma(_sigma), bounds(_bounds), p_change(_p_change) {}
00139 
<a name="l00141"></a><a class="code" href="classeo_normal_mutation.html#a2">00141</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_normal_mutation.html#a2">className</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">"eoNormalMutation"</span>; }
00142 
<a name="l00147"></a><a class="code" href="classeo_normal_mutation.html#a3">00147</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_normal_mutation.html#a3">operator()</a>(<a class="code" href="struct_dummy.html">EOT</a>&amp; _eo)
00148     {
00149       <span class="keywordtype">bool</span> hasChanged=<span class="keyword">false</span>;
00150       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> lieu=0; lieu&lt;_eo.size(); lieu++)
00151         {
00152           <span class="keywordflow">if</span> (rng.<a class="code" href="classeo_rng.html#a6">flip</a>(p_change))
00153             {
00154               _eo[lieu] += sigma*rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00155               bounds.<a class="code" href="classeo_real_base_vector_bounds.html#a10">foldsInBounds</a>(lieu, _eo[lieu]);
00156               hasChanged = <span class="keyword">true</span>;
00157             }
00158         }
00159       <span class="keywordflow">return</span> hasChanged;
00160     }
00161 
<a name="l00163"></a><a class="code" href="classeo_normal_mutation.html#a4">00163</a>   <span class="keywordtype">double</span> &amp; <a class="code" href="classeo_normal_mutation.html#a4">Sigma</a>() {<span class="keywordflow">return</span> sigma;}
00164 
00165 <span class="keyword">private</span>:
00166   <span class="keywordtype">double</span> &amp; sigma;
00167   <a class="code" href="classeo_real_vector_bounds.html">eoRealVectorBounds</a> &amp; bounds;
00168   <span class="keywordtype">double</span> p_change;
00169 };
00170 
<a name="l00177"></a><a class="code" href="classeo_one_fifth_mutation.html">00177</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> EOT&gt; <span class="keyword">class </span><a class="code" href="classeo_one_fifth_mutation.html">eoOneFifthMutation</a> :
00178   <span class="keyword">public</span> <a class="code" href="classeo_normal_mutation.html">eoNormalMutation</a>&lt;EOT&gt;, <span class="keyword">public</span> <a class="code" href="classeo_updatable.html">eoUpdatable</a>
00179 {
00180 <span class="keyword">public</span>:
00181 
00182     <span class="keyword">using</span> <a class="code" href="classeo_normal_mutation.html">eoNormalMutation&lt; EOT &gt;</a>::Sigma;
00183 
00184     <span class="keyword">typedef</span> <span class="keyword">typename</span> EOT::Fitness Fitness;
00185 
<a name="l00195"></a><a class="code" href="classeo_one_fifth_mutation.html#a0">00195</a>   <a class="code" href="classeo_one_fifth_mutation.html#a0">eoOneFifthMutation</a>(<a class="code" href="classeo_eval_func.html">eoEvalFunc&lt;EOT&gt;</a> &amp; _eval, <span class="keywordtype">double</span> &amp; _sigmaInit,
00196                      <span class="keywordtype">unsigned</span> _windowSize = 10, <span class="keywordtype">double</span> _updateFactor=0.83,
00197                      <span class="keywordtype">double</span> _threshold=0.2):
00198     <a class="code" href="classeo_normal_mutation.html">eoNormalMutation</a>&lt;<a class="code" href="struct_dummy.html">EOT</a>&gt;(_sigmaInit), eval(_eval),
00199     threshold(_threshold), updateFactor(_updateFactor),
00200     nbMut(_windowSize, 0), nbSuccess(_windowSize, 0), genIndex(0)
00201   {
00202     <span class="comment">// minimal check</span>
00203     <span class="keywordflow">if</span> (updateFactor&gt;=1)
00204       <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"Update factor must be &lt; 1 in eoOneFifthMutation"</span>);
00205   }
00206 
<a name="l00208"></a><a class="code" href="classeo_one_fifth_mutation.html#a1">00208</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_one_fifth_mutation.html#a1">className</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">"eoOneFifthMutation"</span>; }
00209 
<a name="l00216"></a><a class="code" href="classeo_one_fifth_mutation.html#a2">00216</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_one_fifth_mutation.html#a2">operator()</a>(<a class="code" href="struct_dummy.html">EOT</a> &amp; _eo)
00217     {
00218       <span class="keywordflow">if</span> (_eo.<a class="code" href="class_e_o.html#a5">invalid</a>())           <span class="comment">// due to some crossover???</span>
00219         eval(_eo);
00220       Fitness oldFitness = _eo.<a class="code" href="class_e_o.html#a2">fitness</a>(); <span class="comment">// save old fitness</span>
00221 
00222       <span class="comment">// call standard operator - then count the successes</span>
00223       <span class="keywordflow">if</span> (<a class="code" href="classeo_normal_mutation.html#a3">eoNormalMutation&lt;EOT&gt;::operator()</a>(_eo)) <span class="comment">// _eo has been modified</span>
00224         {
00225           _eo.<a class="code" href="class_e_o.html#a3">invalidate</a>();        <span class="comment">// don't forget!!!</span>
00226           nbMut[genIndex]++;
00227           eval(_eo);               <span class="comment">// compute fitness of offspring</span>
00228 
00229           <span class="keywordflow">if</span> (_eo.<a class="code" href="class_e_o.html#a2">fitness</a>() &gt; oldFitness)
00230             nbSuccess[genIndex]++;          <span class="comment">// update counter</span>
00231         }
00232       <span class="keywordflow">return</span> <span class="keyword">false</span>;                <span class="comment">// because eval has reset the validity flag</span>
00233     }
00234 
<a name="l00238"></a><a class="code" href="classeo_one_fifth_mutation.html#a3">00238</a>   <span class="keywordtype">void</span> <a class="code" href="classeo_one_fifth_mutation.html#a3">update</a>()
00239   {
00240     <span class="keywordtype">unsigned</span> totalMut = 0;
00241     <span class="keywordtype">unsigned</span> totalSuccess = 0;
00242     <span class="comment">// compute the average stats over the time window</span>
00243     <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> i=0; i&lt;nbMut.size(); i++)
00244       {
00245         totalMut += nbMut[i];
00246         totalSuccess += nbSuccess[i];
00247       }
00248 
00249     <span class="comment">// update sigma accordingly</span>
00250     <span class="keywordtype">double</span> prop = double(totalSuccess) / totalMut;
00251     <span class="keywordflow">if</span> (prop &gt; threshold) {
00252       <a class="code" href="classeo_normal_mutation.html#a4">Sigma</a>() /= updateFactor;     <span class="comment">// increase sigma</span>
00253     }
00254     <span class="keywordflow">else</span>
00255       {
00256         <a class="code" href="classeo_normal_mutation.html#a4">Sigma</a>() *= updateFactor;           <span class="comment">// decrease sigma</span>
00257       }
00258     genIndex = (genIndex+1) % nbMut.size() ;
00259     nbMut[genIndex] = nbSuccess[genIndex] = 0;
00260 
00261   }
00262 
00263 <span class="keyword">private</span>:
00264   <a class="code" href="classeo_eval_func.html">eoEvalFunc&lt;EOT&gt;</a> &amp; eval;
00265   <span class="keywordtype">double</span> threshold;                <span class="comment">// 1/5 !</span>
00266   <span class="keywordtype">double</span> updateFactor ;            <span class="comment">// the multiplicative factor</span>
00267   std::vector&lt;unsigned&gt; nbMut;     <span class="comment">// total number of mutations per gen</span>
00268   std::vector&lt;unsigned&gt; nbSuccess;         <span class="comment">// number of successful mutations per gen</span>
00269   <span class="keywordtype">unsigned</span> genIndex ;              <span class="comment">// current index in std::vectors (circular)</span>
00270 };
00271 
00272 
00273 <span class="comment">//-----------------------------------------------------------------------------</span>
00275 <span class="comment"></span><span class="preprocessor">#endif</span>
00276 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 05:06:36 2006 for EO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
