<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EO: eoEsMutate.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000010.html">es</a></div>
<h1>eoEsMutate.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// -*- mode: c++; c-indent-level: 4; c++-member-init-indent: 8; comment-column: 35; fill-column: 80; -*-</span>
00002 
00003 <span class="comment">//-----------------------------------------------------------------------------</span>
00004 <span class="comment">// eoESMute.h : ES mutation</span>
00005 <span class="comment">// (c) Maarten Keijzer 2000 &amp; GeNeura Team, 1998 for the EO part</span>
00006 <span class="comment">//     Th. Baeck 1994 and EEAAX 1999 for the ES part</span>
00007 <span class="comment">/*</span>
00008 <span class="comment">    This library is free software; you can redistribute it and/or</span>
00009 <span class="comment">    modify it under the terms of the GNU Lesser General Public</span>
00010 <span class="comment">    License as published by the Free Software Foundation; either</span>
00011 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
00012 <span class="comment"></span>
00013 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
00014 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00015 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00016 <span class="comment">    Lesser General Public License for more details.</span>
00017 <span class="comment"></span>
00018 <span class="comment">    You should have received a copy of the GNU Lesser General Public</span>
00019 <span class="comment">    License along with this library; if not, write to the Free Software</span>
00020 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00021 <span class="comment"></span>
00022 <span class="comment">    Contact: todos@geneura.ugr.es, http://geneura.ugr.es</span>
00023 <span class="comment">             marc.schoenauer@polytechnique.fr</span>
00024 <span class="comment">                       http://eeaax.cmap.polytchnique.fr/</span>
00025 <span class="comment"> */</span>
00026 <span class="comment">//-----------------------------------------------------------------------------</span>
00027 
00028 
00029 <span class="preprocessor">#ifndef _EOESMUTATE_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#define _EOESMUTATE_H</span>
00031 <span class="preprocessor"></span>
00032 <span class="preprocessor">#include &lt;cmath&gt;</span>
00033 <span class="preprocessor">#include &lt;eoInit.h&gt;</span>
00034 <span class="preprocessor">#include &lt;eoOp.h&gt;</span>
00035 <span class="preprocessor">#include &lt;es/eoEsMutationInit.h&gt;</span>
00036 <span class="preprocessor">#include &lt;es/eoEsSimple.h&gt;</span>
00037 <span class="preprocessor">#include &lt;es/eoEsStdev.h&gt;</span>
00038 <span class="preprocessor">#include &lt;es/eoEsFull.h&gt;</span>
00039 <span class="preprocessor">#include &lt;utils/eoRealBounds.h&gt;</span>
00040 <span class="preprocessor">#include &lt;utils/eoRNG.h&gt;</span>
00041 
00042 <span class="preprocessor">#ifndef M_PI</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define M_PI 3.1415926535897932384626433832795</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00045 <span class="preprocessor"></span>
00059 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
<a name="l00060"></a><a class="code" href="classeo_es_mutate.html">00060</a> <span class="keyword">class </span><a class="code" href="classeo_es_mutate.html">eoEsMutate</a> : <span class="keyword">public</span> <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt; EOT &gt;
00061 {
00062 <span class="keyword">public</span>:
00063 
<a name="l00065"></a><a class="code" href="classeo_es_mutate.html#w0">00065</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> EOT::Fitness FitT;
00066 
00067 
<a name="l00074"></a><a class="code" href="classeo_es_mutate.html#a0">00074</a>     <a class="code" href="classeo_es_mutate.html#a0">eoEsMutate</a>(<a class="code" href="classeo_es_mutation_init.html">eoEsMutationInit</a>&amp; _init, <a class="code" href="classeo_real_vector_bounds.html">eoRealVectorBounds</a>&amp; _bounds) : <a class="code" href="classeo_es_mutate.html#r3">bounds</a>(_bounds)
00075     {
00076         <a class="code" href="classeo_es_mutate.html#d0">init</a>(<a class="code" href="struct_dummy.html">EOT</a>(), _init); <span class="comment">// initialize on actual type used</span>
00077     }
00078 
00079 
<a name="l00081"></a><a class="code" href="classeo_es_mutate.html#a1">00081</a>     <span class="keyword">virtual</span> <a class="code" href="classeo_es_mutate.html#a1">~eoEsMutate</a>() {};
00082 
00083 
<a name="l00090"></a><a class="code" href="classeo_es_mutate.html#a2">00090</a>     <span class="keyword">virtual</span> std::string <a class="code" href="classeo_es_mutate.html#a2">className</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <span class="stringliteral">"eoESMutate"</span>;};
00091 
00092 
<a name="l00097"></a><a class="code" href="classeo_es_mutate.html#a3">00097</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classeo_es_mutate.html#a3">operator()</a>( <a class="code" href="classeo_es_simple.html">eoEsSimple&lt;FitT&gt;</a>&amp; _eo)
00098         {
00099             _eo.<a class="code" href="classeo_es_simple.html#o0">stdev</a> *= exp(<a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> * rng.<a class="code" href="classeo_rng.html#a7">normal</a>());
00100             <span class="keywordflow">if</span> (_eo.<a class="code" href="classeo_es_simple.html#o0">stdev</a> &lt; stdev_eps)
00101                 _eo.<a class="code" href="classeo_es_simple.html#o0">stdev</a> = stdev_eps;
00102             <span class="comment">// now apply to all</span>
00103             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; _eo.size(); ++i)
00104             {
00105                 _eo[i] += _eo.<a class="code" href="classeo_es_simple.html#o0">stdev</a> * rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00106             }
00107             <a class="code" href="classeo_es_mutate.html#r3">bounds</a>.<a class="code" href="classeo_real_base_vector_bounds.html#a10">foldsInBounds</a>(_eo);
00108             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00109         }
00110 
00111 
<a name="l00128"></a><a class="code" href="classeo_es_mutate.html#a4">00128</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classeo_es_mutate.html#a3">operator()</a>( <a class="code" href="classeo_es_stdev.html">eoEsStdev&lt;FitT&gt;</a>&amp; _eo )
00129         {
00130             <span class="keywordtype">double</span> global = <a class="code" href="classeo_es_mutate.html#r1">TauGlb</a> * rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00131             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; _eo.size(); i++)
00132             {
00133                 <span class="keywordtype">double</span> stdev = _eo.<a class="code" href="classeo_es_stdev.html#o0">stdevs</a>[i];
00134                 stdev *= exp( global + <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> * rng.<a class="code" href="classeo_rng.html#a7">normal</a>() );
00135                 <span class="keywordflow">if</span> (stdev &lt; stdev_eps)
00136                     stdev = stdev_eps;
00137                 _eo.<a class="code" href="classeo_es_stdev.html#o0">stdevs</a>[i] = stdev;
00138                 _eo[i] += stdev * rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00139             }
00140             <a class="code" href="classeo_es_mutate.html#r3">bounds</a>.<a class="code" href="classeo_real_base_vector_bounds.html#a10">foldsInBounds</a>(_eo);
00141             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00142         }
00143 
00144 
<a name="l00159"></a><a class="code" href="classeo_es_mutate.html#a5">00159</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classeo_es_mutate.html#a3">operator()</a>( <a class="code" href="classeo_es_full.html">eoEsFull&lt;FitT&gt;</a> &amp; _eo )
00160     <span class="comment">// Code originally from Thomas Bäck</span>
00161         {
00162             <span class="comment">// First: mutate standard deviations (as for eoEsStdev&lt;FitT&gt;).</span>
00163             <span class="keywordtype">double</span> global = <a class="code" href="classeo_es_mutate.html#r1">TauGlb</a> * rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00164             <span class="keywordtype">unsigned</span> i;
00165             <span class="keywordflow">for</span> (i = 0; i &lt; _eo.size(); i++)
00166             {
00167                 <span class="keywordtype">double</span> stdev = _eo.<a class="code" href="classeo_es_full.html#o0">stdevs</a>[i];
00168                 stdev *= exp( global + <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a>*rng.<a class="code" href="classeo_rng.html#a7">normal</a>() );
00169                 <span class="keywordflow">if</span> (stdev &lt; stdev_eps)
00170                     stdev = stdev_eps;
00171                 _eo.<a class="code" href="classeo_es_full.html#o0">stdevs</a>[i] = stdev;
00172             }
00173             <span class="comment">// Mutate rotation angles.</span>
00174             <span class="keywordflow">for</span> (i = 0; i &lt; _eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>.size(); i++)
00175             {
00176                 _eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>[i] += <a class="code" href="classeo_es_mutate.html#r2">TauBeta</a> * rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00177                 <span class="keywordflow">if</span> ( fabs(_eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>[i]) &gt; M_PI )
00178                 {
00179                     _eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>[i] -= M_PI * (int) (_eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>[i]/M_PI) ;
00180                 }
00181             }
00182             <span class="comment">// Perform correlated mutations.</span>
00183             <span class="keywordtype">unsigned</span> k, n1, n2;
00184             <span class="keywordtype">double</span> d1,d2, S, C;
00185             std::vector&lt;double&gt; VarStp(_eo.size());
00186             <span class="keywordflow">for</span> (i = 0; i &lt; _eo.size(); i++)
00187                 VarStp[i] = _eo.<a class="code" href="classeo_es_full.html#o0">stdevs</a>[i] * rng.<a class="code" href="classeo_rng.html#a7">normal</a>();
00188             <span class="keywordtype">unsigned</span> nq = _eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>.size() - 1;
00189             <span class="keywordflow">for</span> (k = 0; k &lt; _eo.size()-1; k++)
00190             {
00191                 n1 = _eo.size() - k - 1;
00192                 n2 = _eo.size() - 1;
00193                 <span class="keywordflow">for</span> (i = 0; i &lt; k; i++)
00194                 {
00195                     d1 = VarStp[n1];
00196                     d2 = VarStp[n2];
00197                     S  = sin( _eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>[nq] );
00198                     C  = cos( _eo.<a class="code" href="classeo_es_full.html#o1">correlations</a>[nq] );
00199                     VarStp[n2] = d1 * S + d2 * C;
00200                     VarStp[n1] = d1 * C - d2 * S;
00201                     n2--;
00202                     nq--;
00203                 }
00204             }
00205             <span class="keywordflow">for</span> (i = 0; i &lt; _eo.size(); i++)
00206                 _eo[i] += VarStp[i];
00207             <a class="code" href="classeo_es_mutate.html#r3">bounds</a>.<a class="code" href="classeo_real_base_vector_bounds.html#a10">foldsInBounds</a>(_eo);
00208             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00209         }
00210 
00211 
00212   <span class="keyword">private</span> :
00213 
<a name="l00215"></a><a class="code" href="classeo_es_mutate.html#d0">00215</a>     <span class="keywordtype">void</span> <a class="code" href="classeo_es_mutate.html#d0">init</a>(<a class="code" href="classeo_es_simple.html">eoEsSimple&lt;FitT&gt;</a>, <a class="code" href="classeo_es_mutation_init.html">eoEsMutationInit</a>&amp; _init)
00216     {
00217         <span class="keywordtype">unsigned</span> size = <a class="code" href="classeo_es_mutate.html#r3">bounds</a>.size();
00218         <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> = _init.<a class="code" href="classeo_es_mutation_init.html#a2">TauLcl</a>();
00219         <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> /= sqrt(2*(<span class="keywordtype">double</span>) size);
00220         std::cout &lt;&lt; <span class="stringliteral">"Init&lt;eoEsSimple&gt;: tau local "</span> &lt;&lt; <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> &lt;&lt; std::endl;
00221     }
00222 
00223 
<a name="l00228"></a><a class="code" href="classeo_es_mutate.html#d1">00228</a>     <span class="keywordtype">void</span> <a class="code" href="classeo_es_mutate.html#d0">init</a>(<a class="code" href="classeo_es_stdev.html">eoEsStdev&lt;FitT&gt;</a>, <a class="code" href="classeo_es_mutation_init.html">eoEsMutationInit</a>&amp; _init)
00229     {
00230         <span class="keywordtype">unsigned</span> size = <a class="code" href="classeo_es_mutate.html#r3">bounds</a>.size();
00231         <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> = _init.<a class="code" href="classeo_es_mutation_init.html#a2">TauLcl</a>();
00232         <a class="code" href="classeo_es_mutate.html#r1">TauGlb</a> = _init.<a class="code" href="classeo_es_mutation_init.html#a3">TauGlb</a>();
00233         <span class="comment">// renormalization</span>
00234         <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> /= sqrt( 2.0 * sqrt(<span class="keywordtype">double</span>(size)) );
00235         <a class="code" href="classeo_es_mutate.html#r1">TauGlb</a> /= sqrt( 2.0 * <span class="keywordtype">double</span>(size) );
00236         std::cout &lt;&lt; <span class="stringliteral">"Init&lt;eoStDev&gt;: tau local "</span> &lt;&lt; <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> &lt;&lt; <span class="stringliteral">" et global "</span> &lt;&lt; <a class="code" href="classeo_es_mutate.html#r1">TauGlb</a> &lt;&lt; std::endl;
00237     }
00238 
00239 
<a name="l00244"></a><a class="code" href="classeo_es_mutate.html#d2">00244</a>     <span class="keywordtype">void</span> <a class="code" href="classeo_es_mutate.html#d0">init</a>(<a class="code" href="classeo_es_full.html">eoEsFull&lt;FitT&gt;</a>, <a class="code" href="classeo_es_mutation_init.html">eoEsMutationInit</a>&amp; _init)
00245     {
00246         <a class="code" href="classeo_es_mutate.html#d0">init</a>(<a class="code" href="classeo_es_stdev.html">eoEsStdev&lt;FitT&gt;</a>(), _init);
00247         <a class="code" href="classeo_es_mutate.html#r2">TauBeta</a> = _init.<a class="code" href="classeo_es_mutation_init.html#a4">TauBeta</a>();
00248         std::cout &lt;&lt; <span class="stringliteral">"Init&lt;eoEsFull&gt;: tau local "</span> &lt;&lt; <a class="code" href="classeo_es_mutate.html#r0">TauLcl</a> &lt;&lt; <span class="stringliteral">" et global "</span> &lt;&lt; <a class="code" href="classeo_es_mutate.html#r1">TauGlb</a> &lt;&lt; std::endl;
00249     }
00250 
00251 
<a name="l00253"></a><a class="code" href="classeo_es_mutate.html#r0">00253</a>     <span class="keywordtype">double</span> TauLcl;
00254 
<a name="l00256"></a><a class="code" href="classeo_es_mutate.html#r1">00256</a>     <span class="keywordtype">double</span> TauGlb;
00257 
<a name="l00259"></a><a class="code" href="classeo_es_mutate.html#r2">00259</a>     <span class="keywordtype">double</span> TauBeta;
00260 
<a name="l00262"></a><a class="code" href="classeo_es_mutate.html#r3">00262</a>     <a class="code" href="classeo_real_vector_bounds.html">eoRealVectorBounds</a>&amp; bounds;
00263 
00278     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> stdev_eps;
00279 };
00280 
00281 
00282 <span class="comment">// Minimum value of stdevs, see declaration for details.</span>
00283 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
<a name="l00284"></a><a class="code" href="classeo_es_mutate.html#v0">00284</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="classeo_es_mutate.html">eoEsMutate&lt;EOT&gt;</a>::stdev_eps = 1.0e-40;
00285 
00286 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 05:06:35 2006 for EO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
