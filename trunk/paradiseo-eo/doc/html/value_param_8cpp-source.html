<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EO: valueParam.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">pyeo</a></div>
<h1>valueParam.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">    PyEO</span>
00003 <span class="comment">    </span>
00004 <span class="comment">    Copyright (C) 2003 Maarten Keijzer</span>
00005 <span class="comment"></span>
00006 <span class="comment">    This program is free software; you can redistribute it and/or modify</span>
00007 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
00008 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
00009 <span class="comment">    (at your option) any later version.</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This program is distributed in the hope that it will be useful,</span>
00012 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00013 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00014 <span class="comment">    GNU General Public License for more details.</span>
00015 <span class="comment"></span>
00016 <span class="comment">    You should have received a copy of the GNU General Public License</span>
00017 <span class="comment">    along with this program; if not, write to the Free Software</span>
00018 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00019 <span class="comment">*/</span>
00020 
00021 <span class="preprocessor">#include &lt;utils/eoParam.h&gt;</span>
00022 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00023 
00024 <span class="comment">// Here's 'len'. Why? dunno</span>
00025 <span class="preprocessor">#include "valueParam.h"</span>
00026 <span class="preprocessor">#include &lt;boost/python/detail/api_placeholder.hpp&gt;</span>
00027 
00028 <span class="keyword">using</span> <span class="keyword">namespace </span>boost::python;
00029 
00030 <span class="keyword">class </span>ParamWrapper : <span class="keyword">public</span> <a class="code" href="classeo_param.html">eoParam</a>
00031 {
00032 <span class="keyword">public</span>:
00033     PyObject* <span class="keyword">self</span>;
00034     ParamWrapper(PyObject* p) : self(p) {}
00035     ParamWrapper(PyObject* p,
00036         std::string a,
00037         std::string b,
00038         std::string c,
00039         <span class="keywordtype">char</span> d,
00040         <span class="keywordtype">bool</span> e) : <a class="code" href="classeo_param.html">eoParam</a>(a,b,c,d,e), self(p) {}
00041 
00042     
00043     std::string <a class="code" href="classeo_param.html#a3">getValue</a>()<span class="keyword"> const</span>
00044 <span class="keyword">    </span>{
00045         <span class="keywordflow">return</span> call_method&lt;std::string&gt;(<span class="keyword">self</span>, <span class="stringliteral">"getValueAsString"</span>);
00046     }
00047 
00048     <span class="keywordtype">void</span> <a class="code" href="classeo_param.html#a4">setValue</a>(<span class="keyword">const</span> std::string&amp; s)
00049     {
00050         call_method&lt;void&gt;(<span class="keyword">self</span>, <span class="stringliteral">"setValueAsString"</span>, s);
00051     }
00052         
00053 };
00054 
00055 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
00056 <span class="keyword">struct </span>ValueParam_pickle_suite : boost::python::pickle_suite
00057 {
00058     <span class="keyword">static</span>
00059     boost::python::tuple getstate(<span class="keyword">const</span> <a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>&amp; _param)
00060     {
00061         str v(_param.<a class="code" href="classeo_value_param.html#a4">getValue</a>());
00062         str d(_param.<a class="code" href="classeo_param.html#a7">description</a>());
00063         str def(_param.<a class="code" href="classeo_param.html#a8">defValue</a>());
00064         str l(_param.<a class="code" href="classeo_param.html#a6">longName</a>());
00065         object s(_param.<a class="code" href="classeo_param.html#a5">shortName</a>());
00066         object r(_param.<a class="code" href="classeo_param.html#a11">required</a>());    
00067         <span class="keywordflow">return</span> make_tuple(v,d,def,l,s,r);
00068     }
00069     <span class="keyword">static</span>
00070     <span class="keywordtype">void</span> setstate(<a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>&amp; _param, boost::python::tuple pickled)
00071     {
00072         std::string v = extract&lt;std::string&gt;(pickled[0]);
00073         std::string d = extract&lt;std::string&gt;(pickled[1]);
00074         std::string def = extract&lt;std::string&gt;(pickled[2]);
00075         std::string l = extract&lt;std::string&gt;(pickled[3]);
00076         <span class="keywordtype">char</span> s = extract&lt;char&gt;(pickled[4]);
00077         <span class="keywordtype">bool</span> r = extract&lt;bool&gt;(pickled[5]);
00078 
00079         _param = <a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>(T(), l, d, s, r);
00080         _param.<a class="code" href="classeo_param.html#a8">defValue</a>(d);
00081         _param.<a class="code" href="classeo_value_param.html#a5">setValue</a>(v);
00082     }
00083 };
00084 
00085 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> U&gt;
00086 U getv(<span class="keyword">const</span> <a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>&amp; v)    { <span class="keywordflow">return</span> v.<a class="code" href="classeo_value_param.html#a2">value</a>(); }
00087 
00088 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> U&gt;
00089 <span class="keywordtype">void</span> setv(<a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>&amp; v, U val) { v.<a class="code" href="classeo_value_param.html#a2">value</a>() = val; }
00090 
00091 <span class="keyword">template</span> &lt;&gt;
00092 numeric::array getv&lt; std::vector&lt;double&gt;, numeric::array &gt;
00093     (<span class="keyword">const</span> <a class="code" href="classeo_value_param.html">eoValueParam&lt; std::vector&lt;double&gt;</a> &gt;&amp; param)
00094 {
00095     <span class="keyword">const</span> std::vector&lt;double&gt;&amp; v = param.<a class="code" href="classeo_value_param.html#a2">value</a>();
00096     list result;
00097 
00098     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i =0; i &lt; v.size(); ++i)
00099         result.append(v[i]);
00100     
00101     <span class="keywordflow">return</span> numeric::array(result);
00102 }
00103 
00104 <span class="keyword">template</span> &lt;&gt;
00105 <span class="keywordtype">void</span> setv&lt; std::vector&lt;double&gt;, numeric::array &gt;
00106     (<a class="code" href="classeo_value_param.html">eoValueParam&lt; std::vector&lt;double&gt;</a> &gt;&amp; param, numeric::array val)
00107 {
00108     std::vector&lt;double&gt;&amp; v = param.<a class="code" href="classeo_value_param.html#a2">value</a>();
00109     v.resize( boost::python::len(val) );
00110     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; v.size(); ++i)
00111     {
00112         extract&lt;double&gt; x(val[i]);
00113         <span class="keywordflow">if</span> (!x.check())
00114             <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"double expected"</span>);
00115         
00116         v[i] = x();
00117     }
00118 }
00119 
00120 <span class="keyword">template</span> &lt;&gt;
00121 tuple getv&lt;std::pair&lt;double, double&gt;, tuple &gt;
00122     (<span class="keyword">const</span> <a class="code" href="classeo_value_param.html">eoValueParam&lt; std::pair&lt;double,double&gt;</a> &gt;&amp; p)
00123 {
00124     <span class="keywordflow">return</span> make_tuple(p.value().first, p.value().second);
00125 }
00126 
00127 <span class="keyword">template</span> &lt;&gt;
00128 <span class="keywordtype">void</span> setv&lt; std::pair&lt;double, double&gt;, tuple &gt;
00129     (<a class="code" href="classeo_value_param.html">eoValueParam&lt; std::pair&lt;double,double&gt;</a> &gt;&amp; p, tuple val)
00130 {
00131     extract&lt;double&gt; first(val[0]);
00132     extract&lt;double&gt; second(val[1]);
00133 
00134     <span class="keywordflow">if</span> (!first.check())
00135         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"doubles expected"</span>);
00136     <span class="keywordflow">if</span> (!second.check())
00137         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"doubles expected"</span>);
00138 
00139     p.<a class="code" href="classeo_value_param.html#a2">value</a>().first = first();
00140     p.<a class="code" href="classeo_value_param.html#a2">value</a>().second = second();
00141 }
00142 
00143 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> U&gt;
00144 <span class="keywordtype">void</span> define_valueParam(std::string prefix)
00145 {
00146     std::string name = <span class="stringliteral">"eoValueParam"</span>;
00147     name += prefix;
00148     
00149     class_&lt;eoValueParam&lt;T&gt;, bases&lt;eoParam&gt; &gt;(name.c_str(), init&lt;&gt;())
00150         .def(init&lt;T, std::string, std::string, char, bool&gt;())
00151         .def(init&lt;T, std::string, std::string, char&gt;())
00152         .def(init&lt;T, std::string, std::string&gt;())
00153         .def(init&lt;T, std::string&gt;())
00154         .def(<span class="stringliteral">"getValueAsString"</span>, &amp;<a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>::getValue)
00155         .def(<span class="stringliteral">"__str__"</span>, &amp;<a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>::getValue)
00156         .def(<span class="stringliteral">"setValueAsString"</span>, &amp;<a class="code" href="classeo_value_param.html">eoValueParam&lt;T&gt;</a>::setValue)
00157         .def(<span class="stringliteral">"getValue"</span>, getv&lt;T, U&gt;)
00158         .def(<span class="stringliteral">"setValue"</span>, setv&lt;T, U&gt;)
00159         .add_property(<span class="stringliteral">"value"</span>, getv&lt;T, U&gt;, setv&lt;T, U&gt;)
00160         .def_pickle(ValueParam_pickle_suite&lt;T&gt;())
00161         ;
00162 }
00163 
00164 <span class="keywordtype">void</span> valueParam()
00165 {
00166     class_&lt;eoParam, ParamWrapper, boost::noncopyable&gt;(<span class="stringliteral">"eoParam"</span>, init&lt;&gt;())
00167         .def(init&lt; std::string, std::string, std::string, char, bool&gt;())
00168         .def(<span class="stringliteral">"getValueAsString"</span>, &amp;ParamWrapper::getValue)
00169         .def(<span class="stringliteral">"setValueAsString"</span>, &amp;ParamWrapper::setValue)
00170         .def(<span class="stringliteral">"longName"</span>, &amp;eoParam::longName, return_value_policy&lt;copy_const_reference&gt;())
00171         <span class="comment">//.def("defValue", &amp;eoParam::defValue, return_value_policy&lt;copy_const_reference&gt;())</span>
00172         .def(<span class="stringliteral">"description"</span>, &amp;eoParam::description, return_value_policy&lt;copy_const_reference&gt;())
00173         .def(<span class="stringliteral">"shortName"</span>, &amp;eoParam::shortName)
00174         .def(<span class="stringliteral">"required"</span>, &amp;eoParam::required)
00175         ;
00176     
00177     define_valueParam&lt;int, int&gt;(<span class="stringliteral">"Int"</span>);
00178     define_valueParam&lt;double, double&gt;(<span class="stringliteral">"Float"</span>);
00179     define_valueParam&lt;std::vector&lt;double&gt;, numeric::array &gt;(<span class="stringliteral">"Vec"</span>);
00180     define_valueParam&lt; std::pair&lt;double, double&gt;, tuple &gt;(<span class="stringliteral">"Pair"</span>);
00181     <span class="comment">//define_valueParam&lt; object, object &gt;("Py");</span>
00182 
00183     class_&lt;ValueParam, bases&lt;eoParam&gt; &gt;(<span class="stringliteral">"eoValueParam"</span>, init&lt;&gt;())
00184         <span class="comment">//.def(init&lt;object, std::string, std::string, char, bool&gt;())</span>
00185         <span class="comment">//.def(init&lt;object, std::string, std::string, char&gt;())</span>
00186         <span class="comment">//.def(init&lt;object, std::string, std::string&gt;())</span>
00187         .def(init&lt;object, std::string&gt;())
00188         .def(<span class="stringliteral">"getValueAsString"</span>, &amp;ValueParam::getValue)
00189         .def(<span class="stringliteral">"__str__"</span>, &amp;ValueParam::getValue)
00190         .def(<span class="stringliteral">"setValueAsString"</span>, &amp;ValueParam::setValue)
00191         .add_property(<span class="stringliteral">"object"</span>, &amp;ValueParam::getObj, &amp;ValueParam::setObj)
00192         ;
00193 }
00194 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 05:06:44 2006 for EO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
