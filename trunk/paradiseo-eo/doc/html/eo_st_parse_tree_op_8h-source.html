<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EO: eoStParseTreeOp.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000017.html">gp</a></div>
<h1>eoStParseTreeOp.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// -*- mode: c++; c-indent-level: 4; c++-member-init-indent: 8; comment-column: 35; -*-</span>
00002  
00003 <span class="comment">//-----------------------------------------------------------------------------</span>
00004 <span class="comment">// eoStParseTreeOp.h : crossover and mutation operators for  the strongly typed GP</span>
00005 <span class="comment">// (c) Jeroen Eggermont 2001 for other mutation operators</span>
00006 
00007 <span class="comment">/*</span>
00008 <span class="comment">    This library is free software; you can redistribute it and/or</span>
00009 <span class="comment">    modify it under the terms of the GNU Lesser General Public</span>
00010 <span class="comment">    License as published by the Free Software Foundation; either</span>
00011 <span class="comment">    version 2 of the License, or (at your option) any later version.</span>
00012 <span class="comment"> </span>
00013 <span class="comment">    This library is distributed in the hope that it will be useful,</span>
00014 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00015 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00016 <span class="comment">    Lesser General Public License for more details.</span>
00017 <span class="comment"> </span>
00018 <span class="comment">    You should have received a copy of the GNU Lesser General Public</span>
00019 <span class="comment">    License along with this library; if not, write to the Free Software</span>
00020 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00021 <span class="comment"> </span>
00022 <span class="comment">    Contact: todos@geneura.ugr.es, http://geneura.ugr.es</span>
00023 <span class="comment">             mak@dhi.dk </span>
00024 <span class="comment">             jeggermo@liacs.nl</span>
00025 <span class="comment"> */</span>
00026 <span class="comment">//-----------------------------------------------------------------------------</span>
00027 
00028 <span class="preprocessor">#ifndef eoStParseTreeOp_h</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#define eoStParseTreeOp_h</span>
00030 <span class="preprocessor"></span>
00031 <span class="preprocessor">#include &lt;EO.h&gt;</span>
00032 <span class="preprocessor">#include &lt;eoOp.h&gt;</span>
00033 <span class="preprocessor">#include &lt;map.h&gt;</span>
00034 <span class="preprocessor">#include &lt;iostream&gt;</span>
00035 
00036 <span class="preprocessor">#include &lt;gp/eoParseTree.h&gt;</span>
00037 
00038 <span class="comment">// a help function</span>
00039 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
00040 <span class="keywordtype">void</span> get_possible_nodes(<span class="keyword">const</span> <a class="code" href="struct_dummy.html">EOT</a> &amp;_eo, std::vector&lt;int&gt; &amp;possible_nodes, <span class="keyword">const</span> <span class="keywordtype">int</span> type)
00041 {
00042         <span class="keywordtype">int</span> n=0;
00043         possible_nodes.clear();
00044         <span class="comment">// collect the possible crossover points in _eo (nodes with the same type)</span>
00045         <span class="keywordflow">for</span>(n=0; n &lt; _eo.size(); n++)
00046                 <span class="keywordflow">if</span> (type == _eo[n]-&gt;type())
00047                         possible_nodes.push_back(n);
00048 }       
00049 
00050 
00055 <span class="keyword">template</span>&lt;<span class="keyword">class</span> FType, <span class="keyword">class</span> Node&gt;
<a name="l00056"></a><a class="code" href="classeo_st_subtree_x_over.html">00056</a> <span class="keyword">class </span><a class="code" href="classeo_st_subtree_x_over.html">eoStSubtreeXOver</a>: <span class="keyword">public</span> <a class="code" href="classeo_quad_op.html">eoQuadOp</a>&lt; eoParseTree&lt;FType, Node&gt; &gt; {
00057 <span class="keyword">public</span>:
00058 
00059   <span class="keyword">typedef</span> <a class="code" href="classeo_parse_tree.html">eoParseTree&lt;FType,Node&gt;</a> <a class="code" href="classeo_parse_tree.html">EoType</a>;
<a name="l00064"></a><a class="code" href="classeo_st_subtree_x_over.html#a0">00064</a>   <a class="code" href="classeo_st_subtree_x_over.html#a0">eoStSubtreeXOver</a>( <span class="keywordtype">unsigned</span> _max_length)
00065     : <a class="code" href="classeo_quad_op.html">eoQuadOp</a>&lt;<a class="code" href="classeo_parse_tree.html">EoType</a>&gt;(), max_length(_max_length) {};
00066 
<a name="l00068"></a><a class="code" href="classeo_st_subtree_x_over.html#a1">00068</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_st_subtree_x_over.html#a1">className</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">"eoStSubtreeXOver"</span>; };
00069 
<a name="l00071"></a><a class="code" href="classeo_st_subtree_x_over.html#a2">00071</a>   <span class="keyword">virtual</span> <a class="code" href="classeo_st_subtree_x_over.html#a2">~eoStSubtreeXOver</a> () {};
00072 
<a name="l00078"></a><a class="code" href="classeo_st_subtree_x_over.html#a3">00078</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_st_subtree_x_over.html#a3">operator()</a>(<a class="code" href="classeo_parse_tree.html">EoType</a> &amp; _eo1, <a class="code" href="classeo_parse_tree.html">EoType</a> &amp; _eo2 )
00079   {
00080           <span class="keywordtype">int</span> i = 0;
00081           std::vector&lt;int&gt; nodes;
00082           <span class="keywordtype">int</span> n = 0;
00083           <span class="keywordtype">int</span> type = 0;
00084           <span class="keywordtype">int</span> j = 0;
00085           set&lt;int&gt; test;
00086           <span class="keywordflow">do</span>
00087           {
00088                 <span class="keywordflow">do</span> <span class="comment">// select a random node in _eo1 as crossover point, and check if we didn't try it already</span>
00089                 {
00090                         i = rng.<a class="code" href="classeo_rng.html#a5">random</a>(_eo1.size());
00091                 }<span class="keywordflow">while</span>(test.count(i) &gt; 0);
00092                 
00093                 test.insert(i);
00094                 
00095                 type = _eo1[i]-&gt;type();
00096                 
00097                 get_possible_nodes&lt;EoType&gt;(_eo2, nodes, type);
00098                 
00099          }<span class="keywordflow">while</span>(nodes.empty() &amp;&amp; (test.size() &lt; _eo1.size()));  
00100          
00101          <span class="keywordflow">if</span> (nodes.empty()) <span class="comment">// we failed to select a crossover point but tried all points (test.size() == _eo1.size()).</span>
00102                 <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// should this be false ??</span>
00103 
00104          <span class="comment">// we did find at least one possible crossover point in _eo2</span>
00105                 
00106          n = rng.<a class="code" href="classeo_rng.html#a5">random</a>(nodes.size());
00107          j = nodes[n];
00108            
00109          parse_tree&lt;Node&gt;::subtree tmp = _eo1[i];
00110          _eo1[i] = _eo2[j]; <span class="comment">// insert subtree</span>
00111          _eo2[j] = tmp;
00112 
00113          <span class="comment">// we can't prune anymore</span>
00114          <span class="comment">/*     </span>
00115 <span class="comment">         _eo1.pruneTree(max_length);</span>
00116 <span class="comment">         _eo2.pruneTree(max_length);</span>
00117 <span class="comment">         */</span>
00118          
00119          <span class="keywordflow">return</span> <span class="keyword">true</span>;
00120   }
00121  <span class="keyword">private</span>:
00122   <span class="keywordtype">unsigned</span> max_length;
00123 };
00124 
00129 <span class="keyword">template</span>&lt;<span class="keyword">class</span> FType, <span class="keyword">class</span> Node&gt;
<a name="l00130"></a><a class="code" href="classeo_st_branch_mutation.html">00130</a> <span class="keyword">class </span><a class="code" href="classeo_st_branch_mutation.html">eoStBranchMutation</a>: <span class="keyword">public</span> <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt; eoParseTree&lt;FType, Node&gt; &gt;
00131 {
00132 <span class="keyword">public</span>:
00133 
00134   <span class="keyword">typedef</span> <a class="code" href="classeo_parse_tree.html">eoParseTree&lt;FType,Node&gt;</a> <a class="code" href="classeo_parse_tree.html">EoType</a>;
<a name="l00140"></a><a class="code" href="classeo_st_branch_mutation.html#a0">00140</a>   <a class="code" href="classeo_st_branch_mutation.html#a0">eoStBranchMutation</a>(<a class="code" href="classeo_init.html">eoInit&lt;EoType&gt;</a>&amp; _init, <span class="keywordtype">unsigned</span> _max_length)
00141     : <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt;<a class="code" href="classeo_parse_tree.html">EoType</a>&gt;(), max_length(_max_length), initializer(_init)
00142   {};
00143   
<a name="l00145"></a><a class="code" href="classeo_st_branch_mutation.html#a1">00145</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_st_branch_mutation.html#a1">className</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">"eoStBranchMutation"</span>; };
00146 
<a name="l00148"></a><a class="code" href="classeo_st_branch_mutation.html#a2">00148</a>   <span class="keyword">virtual</span> <a class="code" href="classeo_st_branch_mutation.html#a2">~eoStBranchMutation</a>() {};
00149   
<a name="l00154"></a><a class="code" href="classeo_st_branch_mutation.html#a3">00154</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_st_branch_mutation.html#a3">operator()</a>(<a class="code" href="classeo_parse_tree.html">EoType</a>&amp; _eo1 )
00155   {
00156           <span class="keywordtype">int</span> i = rng.<a class="code" href="classeo_rng.html#a5">random</a>(_eo1.size());
00157           std::vector&lt;int&gt; nodes;
00158           <span class="keywordtype">int</span> type = _eo1[i]-&gt;type();
00159           <span class="keywordtype">int</span> j=0;
00160           <span class="keywordtype">int</span> n=0;
00161 
00162           <a class="code" href="classeo_parse_tree.html">EoType</a> eo2;
00163           
00164           <span class="keywordflow">do</span>
00165           {
00166                 initializer(eo2);
00167                 get_possible_nodes(eo2, nodes, type);
00168           }<span class="keywordflow">while</span> (nodes.empty());       
00169 
00170           n = rng.<a class="code" href="classeo_rng.html#a5">random</a>(nodes.size());
00171           j = nodes[n];
00172           
00173           _eo1[i] = eo2[j]; <span class="comment">// insert subtree</span>
00174           
00175           <span class="comment">// no more pruning</span>
00176           <span class="comment">/*</span>
00177 <span class="comment">          _eo1.pruneTree(max_length);</span>
00178 <span class="comment">          */</span>
00179 
00180     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00181   }
00182 
00183 <span class="keyword">private</span> :
00184 
00185   <span class="keywordtype">unsigned</span> max_length;
00186   <a class="code" href="classeo_init.html">eoInit&lt;EoType&gt;</a>&amp; initializer;
00187 };
00188 
00189 
00194 <span class="keyword">template</span>&lt;<span class="keyword">class</span> FType, <span class="keyword">class</span> Node&gt;
<a name="l00195"></a><a class="code" href="classeo_st_point_mutation.html">00195</a> <span class="keyword">class </span><a class="code" href="classeo_st_point_mutation.html">eoStPointMutation</a>: <span class="keyword">public</span> <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt; eoParseTree&lt;FType, Node&gt; &gt;
00196 {
00197 <span class="keyword">public</span>:
00198 
00199   <span class="keyword">typedef</span> <a class="code" href="classeo_parse_tree.html">eoParseTree&lt;FType,Node&gt;</a> <a class="code" href="classeo_parse_tree.html">EoType</a>;
00200 
<a name="l00205"></a><a class="code" href="classeo_st_point_mutation.html#a0">00205</a>   <a class="code" href="classeo_st_point_mutation.html#a0">eoStPointMutation</a>( std::vector&lt;Node&gt;&amp; _node)
00206     : <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt;<a class="code" href="classeo_parse_tree.html">EoType</a>&gt;()
00207   {
00208         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;
00209         <span class="keywordtype">int</span> arity=0;
00210         <span class="keywordtype">int</span> type=0;
00211         std::vector&lt;Node&gt; node_std::vector;
00212         <span class="keywordflow">for</span>(i=0; i &lt; _node.size(); i++)
00213         {
00214                 arity = _node[i].arity();
00215                 type = _node[i].type();
00216                 
00217                         node_std::vector = node[type][arity];
00218                         node_std::vector.push_back(_node[i]);
00219                         node[type][arity]= node_std::vector;
00220                 
00221         };
00222   };
00223   
<a name="l00225"></a><a class="code" href="classeo_st_point_mutation.html#a1">00225</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_st_point_mutation.html#a1">className</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">"eoStPointMutation"</span>; };
00226 
<a name="l00228"></a><a class="code" href="classeo_st_point_mutation.html#a2">00228</a>   <span class="keyword">virtual</span> <a class="code" href="classeo_st_point_mutation.html#a2">~eoStPointMutation</a>() {};
00229 
<a name="l00234"></a><a class="code" href="classeo_st_point_mutation.html#a3">00234</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_st_point_mutation.html#a3">operator()</a>(<a class="code" href="classeo_parse_tree.html">EoType</a>&amp; _eo1 )
00235   {
00236         <span class="comment">// select a random node i that is to be mutated</span>
00237         <span class="keywordtype">int</span> i = rng.<a class="code" href="classeo_rng.html#a5">random</a>(_eo1.size());
00238         <span class="keywordtype">int</span> arity = _eo1[i].arity();
00239         <span class="keywordtype">int</span> type = _eo1[i]-&gt;type();
00240         <span class="keywordtype">int</span> j = rng.<a class="code" href="classeo_rng.html#a5">random</a>(node[type][arity].size());
00241 
00242         
00243         _eo1[i] = node[type][arity][j];
00244         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00245   }
00246 
00247 <span class="keyword">private</span> :
00248         
00249         map &lt; int, map &lt; int, std::vector&lt;Node&gt; &gt; &gt; node;
00250 };
00251 
00252  
00257 <span class="keyword">template</span>&lt;<span class="keyword">class</span> FType, <span class="keyword">class</span> Node&gt;
<a name="l00258"></a><a class="code" href="classeo_st_hoist_mutation.html">00258</a> <span class="keyword">class </span><a class="code" href="classeo_st_hoist_mutation.html">eoStHoistMutation</a>: <span class="keyword">public</span> <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt; eoParseTree&lt;FType, Node&gt; &gt;
00259 {
00260 <span class="keyword">public</span>:
00261 
00262   <span class="keyword">typedef</span> <a class="code" href="classeo_parse_tree.html">eoParseTree&lt;FType,Node&gt;</a> <a class="code" href="classeo_parse_tree.html">EoType</a>;
<a name="l00268"></a><a class="code" href="classeo_st_hoist_mutation.html#a0">00268</a>   <a class="code" href="classeo_st_hoist_mutation.html#a0">eoStHoistMutation</a>(<a class="code" href="classeo_init.html">eoInit&lt;EoType&gt;</a>&amp; _init, <span class="keywordtype">unsigned</span> _max_length)
00269     : <a class="code" href="classeo_mon_op.html">eoMonOp</a>&lt;<a class="code" href="classeo_parse_tree.html">EoType</a>&gt;(), max_length(_max_length), initializer(_init)
00270   {};
00271   
<a name="l00273"></a><a class="code" href="classeo_st_hoist_mutation.html#a1">00273</a>   <span class="keyword">virtual</span> std::string <a class="code" href="classeo_st_hoist_mutation.html#a1">className</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">"eoStHoistMutation"</span>; };
00274 
<a name="l00276"></a><a class="code" href="classeo_st_hoist_mutation.html#a2">00276</a>   <span class="keyword">virtual</span> <a class="code" href="classeo_st_hoist_mutation.html#a2">~eoStHoistMutation</a>() {};
00277   
<a name="l00282"></a><a class="code" href="classeo_st_hoist_mutation.html#a3">00282</a>   <span class="keywordtype">bool</span> <a class="code" href="classeo_st_hoist_mutation.html#a3">operator()</a>(<a class="code" href="classeo_parse_tree.html">EoType</a>&amp; _eo1 )
00283   {
00284 
00285           std::vector&lt;int&gt; nodes;
00286           <span class="comment">// get the type of the current tree</span>
00287           <span class="keywordtype">int</span> type = _eo1[ _eo1.size() - 1 ]-&gt;type();
00288 
00289         
00290           
00291           <span class="keywordflow">do</span>
00292           {
00293                 initializer(eo2);
00294                 get_possible_nodes(eo2, nodes, type);
00295           }<span class="keywordflow">while</span> (nodes.empty());       
00296           
00297           <span class="comment">// select a subtree-node to replace the current tree</span>
00298           <span class="keywordtype">int</span> n = rng.<a class="code" href="classeo_rng.html#a5">random</a>(nodes.size());
00299           <span class="keywordtype">int</span> i = nodes[n];
00300           
00301           <a class="code" href="classeo_parse_tree.html">EoType</a> eo2(_eo1[i]);
00302           
00303           _eo1 = eo2;
00304 
00305           <span class="keywordflow">return</span> <span class="keyword">true</span>;
00306   }
00307 
00308 <span class="keyword">private</span> :
00309 
00310   <span class="keywordtype">unsigned</span> max_length;
00311   <a class="code" href="classeo_init.html">eoInit&lt;EoType&gt;</a>&amp; initializer;
00312 };
00313 
00314 
00315 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 05:06:38 2006 for EO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
