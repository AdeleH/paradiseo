<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EO: eoReduceMergeReduce.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>eoReduceMergeReduce.h</h1><div class="fragment"><pre class="fragment">00001 
00024 <span class="comment">//-----------------------------------------------------------------------------</span>
00025 
00026 <span class="preprocessor">#ifndef _eoReduceMergeReduce_h</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define _eoReduceMergeReduce_h</span>
00028 <span class="preprocessor"></span>
00029 
00030 <span class="comment">//-----------------------------------------------------------------------------</span>
00031 <span class="preprocessor">#include &lt;eoPop.h&gt;</span>
00032 <span class="preprocessor">#include &lt;eoFunctor.h&gt;</span>
00033 <span class="preprocessor">#include &lt;eoMerge.h&gt;</span>
00034 <span class="preprocessor">#include &lt;eoReduce.h&gt;</span>
00035 <span class="preprocessor">#include &lt;utils/eoHowMany.h&gt;</span>
00036 <span class="comment">//-----------------------------------------------------------------------------</span>
00037 
00048 <span class="keyword">template</span> &lt;<span class="keyword">class</span> EOT&gt;
<a name="l00049"></a><a class="code" href="classeo_reduce_merge_reduce.html">00049</a> <span class="keyword">class </span><a class="code" href="classeo_reduce_merge_reduce.html">eoReduceMergeReduce</a> : <span class="keyword">public</span> <a class="code" href="classeo_replacement.html">eoReplacement</a>&lt;EOT&gt;
00050 {
00051 <span class="keyword">public</span>:
00052   <a class="code" href="classeo_reduce_merge_reduce.html">eoReduceMergeReduce</a>(<a class="code" href="classeo_how_many.html">eoHowMany</a> _howManyElite, 
00053                       <span class="keywordtype">bool</span> _strongElitism, 
00054                       <a class="code" href="classeo_how_many.html">eoHowMany</a> _howManyReducedParents,
00055                       <a class="code" href="classeo_reduce.html">eoReduce&lt;EOT&gt;</a> &amp; _reduceParents,
00056                       <a class="code" href="classeo_how_many.html">eoHowMany</a> _howManyReducedOffspring, 
00057                       <a class="code" href="classeo_reduce.html">eoReduce&lt;EOT&gt;</a> &amp; _reduceOffspring,
00058                       <a class="code" href="classeo_reduce.html">eoReduce&lt;EOT&gt;</a> &amp; _reduceFinal) :
00059     howManyElite(_howManyElite),
00060     strongElitism(_strongElitism),
00061     howManyReducedParents(_howManyReducedParents),
00062     howManyReducedOffspring (_howManyReducedOffspring),
00063     reduceParents(_reduceParents),
00064     reduceOffspring(_reduceOffspring),
00065     reduceFinal(_reduceFinal)
00066   {}
00067     
<a name="l00068"></a><a class="code" href="classeo_reduce_merge_reduce.html#a1">00068</a>     <span class="keywordtype">void</span> <a class="code" href="classeo_reduce_merge_reduce.html#a1">operator()</a>(<a class="code" href="classeo_pop.html">eoPop&lt;EOT&gt;</a> &amp; _parents, <a class="code" href="classeo_pop.html">eoPop&lt;EOT&gt;</a> &amp; _offspring)
00069     {
00070       <a class="code" href="classeo_pop.html">eoPop&lt;EOT&gt;</a> temp;
00071       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> finalPopSize = _parents.size();
00072       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offSize = _offspring.size();
00073 
00074       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> elite = howManyElite(finalPopSize);
00075       <span class="keywordflow">if</span> (elite)                   <span class="comment">// some parents MUST be saved somewhere</span>
00076         {
00077           temp.resize(elite);
00078           _parents.<a class="code" href="classeo_pop.html#a13">nth_element</a>(elite);
00079           std::copy(_parents.begin(), _parents.begin()+elite, temp.begin());
00080           _parents.erase(_parents.begin(), _parents.begin()+elite);
00081         }
00082 
00083       <span class="comment">// the reduce steps. First the parents</span>
00084       <span class="keywordtype">unsigned</span> reducedParentSize = howManyReducedParents(_parents.size());
00085       <span class="keywordflow">if</span> (!reducedParentSize)
00086         _parents.clear();
00087       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reducedParentSize != _parents.size())
00088         reduceParents(_parents, reducedParentSize);
00089 
00090       <span class="comment">// then the offspring</span>
00091       <span class="keywordtype">unsigned</span> reducedOffspringSize = howManyReducedOffspring(offSize);
00092       <span class="keywordflow">if</span> (!reducedOffspringSize)
00093         <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">"No offspring left after reduction!"</span>);
00094       <span class="keywordflow">if</span> (reducedOffspringSize != offSize) <span class="comment">// need reduction</span>
00095         reduceOffspring(_offspring, reducedOffspringSize);
00096 
00097       <span class="comment">// now merge reduced populations</span>
00098       _parents.resize(reducedParentSize + _offspring.size());
00099       std::copy(_offspring.begin(), _offspring.end(), 
00100                 _parents.begin()+reducedParentSize); 
00101 
00102       <span class="comment">// reduce the resulting population</span>
00103       <span class="comment">// size depstd::ends on elitism</span>
00104       <span class="keywordflow">if</span> (elite &amp;&amp; strongElitism)
00105         {
00106           <span class="keywordflow">if</span> (_parents.size() != finalPopSize-elite)
00107             reduceFinal(_parents, finalPopSize-elite);
00108           <span class="comment">// and put back the elite</span>
00109           <span class="keywordtype">unsigned</span> oldPSize = _parents.size();
00110           _parents.resize(_parents.size()+elite);
00111           std::copy(temp.begin(), temp.end(), _parents.begin()+oldPSize);
00112         }
00113       <span class="keywordflow">else</span>      
00114         {                   <span class="comment">// only reduce final pop to right size</span>
00115           <span class="keywordflow">if</span> (_parents.size() != finalPopSize)
00116             reduceFinal(_parents, finalPopSize);
00117           <span class="keywordflow">if</span> (elite)       <span class="comment">// then treat weak elitism</span>
00118             {
00119               <span class="keywordtype">unsigned</span> toSave = 0;
00120               _parents.<a class="code" href="classeo_pop.html#a5">sort</a>();
00121               <a class="code" href="struct_dummy.html">EOT</a> &amp; eoLimit = _parents[elite-1];
00122               <span class="keywordtype">unsigned</span> index=0;
00123               <span class="keywordflow">while</span> ( (temp[index++] &gt; eoLimit) &amp;&amp; (index &lt; temp.size()) )
00124                 toSave++;
00125               <span class="keywordflow">if</span> (toSave)
00126                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;toSave; i++)
00127                   _parents[finalPopSize-1-i] = temp[i];
00128             }
00129         }
00130     }
00131 
00132 <span class="keyword">private</span>:
00133   <a class="code" href="classeo_how_many.html">eoHowMany</a> howManyElite;          <span class="comment">// if 0, no elitism at all</span>
00134   <span class="keywordtype">bool</span> strongElitism;              <span class="comment">// if false -&gt; weak estd::listism</span>
00135   <a class="code" href="classeo_how_many.html">eoHowMany</a> howManyReducedParents; <span class="comment">// if 0, no parent in final replacement</span>
00136   <a class="code" href="classeo_how_many.html">eoHowMany</a> howManyReducedOffspring; <span class="comment">// if 0, std::runtime_error</span>
00137   <span class="comment">// the reducers</span>
00138   <a class="code" href="classeo_reduce.html">eoReduce&lt;EOT&gt;</a> &amp; reduceParents;
00139   <a class="code" href="classeo_reduce.html">eoReduce&lt;EOT&gt;</a> &amp; reduceOffspring;
00140   <a class="code" href="classeo_reduce.html">eoReduce&lt;EOT&gt;</a> &amp; reduceFinal;
00141 };
00142 
00143 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 05:06:37 2006 for EO by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
